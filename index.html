<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>Enclavius Lore – Stories</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Favicon -->
  <link rel="icon" type="image/png" href="https://i.gyazo.com/f55b23b0ddcdc810e7df30522a408e57.png" />
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@500;700&family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #f4f1ed;
      --fg: #121212;
      --muted: #6a6a6a;
      --accent: #7c1700;
      --accent-2: #a11f05;
      --card-bg: #ffffff;
      --border: #e6e0da;
      --link: #1b4b91;
      --radius: 14px;
      --shadow: 0 10px 25px rgba(0, 0, 0, .08);
    }

    html, body { height: 100% }
    body {
      margin: 0;
      background: var(--bg);
      color: var(--fg);
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      display: flex;
      flex-direction: column;
      min-height: 100%;
    }

    header {
      max-width: 1100px;
      margin: 0 auto;
      padding: 48px 20px 24px;
      text-align: center;
    }

    .logo {
      width: 80px; height: 80px; margin: 0 auto 16px;
      border-radius: 50%; overflow: hidden;
      box-shadow: var(--shadow);
      outline: 1px solid rgba(0,0,0,.06);
      background: #fff;
    }
    .logo img { width: 100%; height: 100%; object-fit: cover; display: block; }

    header h1 {
      font-family: Cinzel, serif; font-weight: 700;
      font-size: 2.4rem; line-height: 1.2; margin: 0 0 6px; letter-spacing: .3px;
    }
    .tagline { margin: 0 auto 20px; color: var(--muted); max-width: 700px; }

    .toolbar { display: flex; align-items: center; gap: 12px; margin-top: 16px; flex-wrap: wrap; justify-content: center; }
    .search { position: relative; flex: 1 1 320px; max-width: 420px; }
    .search input {
      width: 100%; padding: 12px 14px; border: 1px solid var(--border); border-radius: 10px;
      background: #fff; color: var(--fg); font-size: 14px; outline: none;
    }
    .total-count { color: var(--muted); font-size: 14px }

    main { max-width: 1100px; margin: 0 auto; width: 100%; padding: 12px 20px 40px; display: grid; gap: 28px; }

    /* Section blocks — NO custom bg/shadow, they inherit the page bg */
    .section { display: grid; gap: 12px; background: transparent; box-shadow: none; }

    .section h2 {
      display: flex; align-items: baseline; justify-content: space-between;
      margin: 0; font-size: 1.2rem;
    }
    .count { color: #8b837b; font-size: .9rem; font-weight: 500; }

    /* Horizontal scroller list ONLY — no vertical scroll inside rows */
    .row {
      display: flex;
      flex-wrap: nowrap;        /* keep one horizontal line */
      align-items: stretch;
      gap: 18px;
      overflow-x: auto;         /* horizontal scroll */
      overflow-y: hidden;       /* prevent vertical scroll in the segment */
      padding-bottom: 6px;
      scroll-snap-type: x mandatory;
      -webkit-overflow-scrolling: touch;
      background: transparent;  /* no visual background */
      box-shadow: none;         /* no shadow on the segment */
    }
    .row::-webkit-scrollbar { height: 10px; }
    .row::-webkit-scrollbar-thumb { background: #d5cfc9; border-radius: 999px; }

    .card {
      scroll-snap-align: start;
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      overflow: hidden;
      transition: transform .15s ease, box-shadow .2s ease;
      display: flex; flex-direction: column;
      min-width: 280px;  /* fixed card width inside the horizontal row */
      max-width: 320px;
    }
    .card:hover { transform: translateY(-3px); }

    .cover {
      position: relative; height: 160px; background: #ecd8d3;
      background-size: cover; background-position: center;
    }
    .cover::after {
      content: ""; position: absolute; inset: 0;
      background: linear-gradient(180deg, rgba(0,0,0,0) 40%, rgba(0,0,0,.22) 100%);
    }
    .badge {
      position: absolute; top: 10px; left: 10px;
      background: var(--accent); color: #fff; padding: 4px 8px; font-size: 12px; border-radius: 999px;
    }

    .content { padding: 16px 16px 6px }
    .title { margin: 0 0 6px; font-weight: 600; font-size: 1.05rem }
    .subtitle { margin: 0; color: #5a554f; font-size: .92rem }
    .meta { margin: 10px 16px 0; color: #8b837b; font-size: .8rem }

    .actions { display: flex; gap: 10px; align-items: center; padding: 16px; margin-top: auto; }
    .btn {
      appearance: none; border: none; cursor: pointer; text-decoration: none;
      padding: 10px 14px; border-radius: 10px; font-weight: 600; font-size: .92rem;
      transition: filter .15s ease, transform .05s ease;
    }
    .btn:active { transform: translateY(1px); }
    .btn-primary { background: linear-gradient(180deg, var(--accent-2), var(--accent)); color: #fff; }
    .btn-ghost { background: #f7f3ef; border: 1px solid var(--border); color: #2b2a29; }

    .toast {
      position: fixed; left: 50%; transform: translateX(-50%); bottom: 22px;
      background: #222; color: #fff; padding: 10px 14px; border-radius: 10px; font-size: 14px;
      opacity: 0; pointer-events: none; transition: opacity .2s ease;
    }
    .toast.show { opacity: 1; }

    a { color: var(--link); }

    footer {
      color: #867e76; font-size: .9rem; padding: 20px; max-width: 1100px; margin: 0 auto; width: 100%;
    }

    /* ===== Mobile-only tweaks (phones) ===== */
@media (max-width: 767px) {
  /* Comfortable full-card swipe rows, no layout changes on desktop */
  .row {
    gap: 14px;
    padding: 6px 4px 10px;
    scroll-snap-type: x mandatory;
    -webkit-overflow-scrolling: touch;
  }

  /* Make cards larger on phones; desktop rules remain intact */
  .card {
    min-width: 86vw;
    max-width: 86vw;
    cursor: pointer;
    border: none;           /* keep flat look */
    box-shadow: none;
  }

  /* Taller cover on phones for better visual balance */
  .cover {
    height: 48vw;
  }

  /* Hide the path-like meta line to save vertical space */
  .meta {
    display: none;
  }

  /* Buttons fill width nicely for tapping */
  .actions .btn {
    flex: 1;
    text-align: center;
  }
}

  </style>
</head>

<body>
  <header>
    <div class="brand">
      <div class="logo">
        <img src="https://i.gyazo.com/05e06650b217d7c2993eb5fab466290e.png" alt="Enclavius Logo" />
      </div>
      <h1>Enclavius Lore</h1>
    </div>
    <p class="tagline">Explore the chronicles of Gens Enclavius. Choose a story to begin.</p>

    <div class="toolbar">
      <div class="search">
        <input id="q" type="search" placeholder="Search stories by title…" aria-label="Search stories" />
      </div>
      <div class="total-count" id="total-count"></div>
    </div>
  </header>

  <main>
    <!-- Core -->
    <section class="section" aria-labelledby="core-heading">
      <h2 id="core-heading">
        Core Texts
        <span class="count" id="count-core"></span>
      </h2>
      <div id="row-core" class="row" aria-live="polite"></div>
    </section>

    <!-- Expansion -->
    <section class="section" aria-labelledby="expansion-heading">
      <h2 id="expansion-heading">
        Expansion Texts
        <span class="count" id="count-expansion"></span>
      </h2>
      <div id="row-expansion" class="row" aria-live="polite"></div>
    </section>
  </main>

  <footer>© Gens Enclavius 2025</footer>

  <div id="toast" class="toast" role="status" aria-live="polite">Link copied</div>

  <script src="./js/stories.js"></script>
<script>
  // Normalize stories
  const stories = (window.STORIES || []).map(s => ({
    slug: s.slug,
    title: s.title,
    subtitle: s.subtitle || "",
    cover: s.cover || "",
    badge: s.badge || "",
    category: (s.category || "core").toLowerCase()
  }));

  const rowCore = document.getElementById('row-core');
  const rowExpansion = document.getElementById('row-expansion');
  const countCore = document.getElementById('count-core');
  const countExpansion = document.getElementById('count-expansion');
  const totalCount = document.getElementById('total-count');
  const q = document.getElementById('q');
  const toast = document.getElementById('toast');

  function cardHTML(s) {
    const href = `./stories/${encodeURIComponent(s.slug)}.html`;
    const abs = new URL(href, location.href).href;
    const coverStyle = s.cover
      ? `style="background-image:url('${s.cover.replace(/"/g, '&quot;')}')"`
      : `style="background-image:linear-gradient(135deg,#ecd8d3, #f0e6df)"`;
    return `
      <article class="card" data-href="${href}" role="link" tabindex="0">
        <div class="cover" ${coverStyle}>
          ${s.badge ? `<span class="badge">${s.badge}</span>` : ""}
        </div>
        <div class="content">
          <h3 class="title">${s.title}</h3>
          ${s.subtitle ? `<p class="subtitle">${s.subtitle}</p>` : ""}
        </div>
        <div class="meta">/stories/${s.slug}.html</div>
        <div class="actions">
          <a class="btn btn-primary" href="${href}">Read</a>
          <button class="btn btn-ghost" data-share="${abs}" type="button">Copy link</button>
        </div>
      </article>
    `;
  }

  function renderRows(list) {
    const term = (q.value || "").trim().toLowerCase();
    const matches = term
      ? list.filter(s =>
          s.title.toLowerCase().includes(term) ||
          (s.subtitle && s.subtitle.toLowerCase().includes(term))
        )
      : list;

    const core = matches.filter(s => s.category === 'core');
    const expansion = matches.filter(s => s.category === 'expansion');

    rowCore.innerHTML = core.map(cardHTML).join('');
    rowExpansion.innerHTML = expansion.map(cardHTML).join('');

    // Enable full-card click navigation
    document.querySelectorAll('.card[data-href]').forEach(card => {
      const link = card.getAttribute('data-href');
      card.addEventListener('click', e => {
        // Avoid intercepting button clicks inside the card
        if (e.target.closest('button') || e.target.closest('a')) return;
        window.location.href = link;
      });
      card.addEventListener('keypress', e => {
        if (e.key === 'Enter' || e.key === ' ') {
          window.location.href = link;
        }
      });
      card.style.cursor = 'pointer';
    });

    // Rebind copy buttons
    document.querySelectorAll('[data-share]').forEach(btn => {
      btn.addEventListener('click', async e => {
        const url = e.currentTarget.getAttribute('data-share');
        try { await navigator.clipboard.writeText(url); showToast("Link copied"); }
        catch { showToast("Copy failed"); }
      });
    });

    // Counts
    countCore.textContent = `${core.length} ${core.length === 1 ? "story" : "stories"}`;
    countExpansion.textContent = `${expansion.length} ${expansion.length === 1 ? "story" : "stories"}`;
    totalCount.textContent = `${matches.length} ${matches.length === 1 ? "result" : "results"}`;
  }

  function showToast(msg) {
    toast.textContent = msg;
    toast.classList.add('show');
    setTimeout(() => toast.classList.remove('show'), 1400);
  }

  q.addEventListener('input', () => renderRows(stories));
  renderRows(stories);
</script>
</body>
</html>
